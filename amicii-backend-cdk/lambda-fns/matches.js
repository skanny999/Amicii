"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const db_1 = require("./db");
async function matches(userId) {
    const db = await db_1.getDB();
    const allMatchesIds = await db.$queryRaw `SELECT AU.ID
    FROM USER AU
    JOIN (SELECT B.USERID FROM
    LIKES A
    JOIN
    LIKES B
    ON A.USERID = B.LIKEDUSERID
    WHERE A.USERID = ${userId}
    AND B.USERID = A.LIKEDUSERID
    AND A.USERID = B.LIKEDUSERID) MU
    ON AU.ID = MU.USERID;`;
    const allMatches = await db.user.findMany({
        where: {
            id: {
                in: allMatchesIds.map((item) => item.ID)
            }
        }
    });
    return allMatches;
}
exports.default = matches;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibWF0Y2hlcy5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIm1hdGNoZXMudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7QUFBQSw2QkFBNEI7QUFFNUIsS0FBSyxVQUFVLE9BQU8sQ0FBQyxNQUFjO0lBQ2pDLE1BQU0sRUFBRSxHQUFHLE1BQU0sVUFBSyxFQUFFLENBQUE7SUFFeEIsTUFBTSxhQUFhLEdBQUcsTUFBTSxFQUFFLENBQUMsU0FBUyxDQUFBOzs7Ozs7O3VCQU9yQixNQUFNOzs7MEJBR0gsQ0FBQTtJQUV0QixNQUFNLFVBQVUsR0FBRyxNQUFNLEVBQUUsQ0FBQyxJQUFJLENBQUMsUUFBUSxDQUFDO1FBQ3RDLEtBQUssRUFBRTtZQUNILEVBQUUsRUFBRTtnQkFDQSxFQUFFLEVBQUUsYUFBYSxDQUFDLEdBQUcsQ0FBQyxDQUFDLElBQW9CLEVBQUUsRUFBRSxDQUFDLElBQUksQ0FBQyxFQUFFLENBQUM7YUFDM0Q7U0FDSjtLQUNKLENBQUMsQ0FBQTtJQUNGLE9BQU8sVUFBVSxDQUFBO0FBQ3JCLENBQUM7QUFFRCxrQkFBZSxPQUFPLENBQUEiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBnZXREQiB9IGZyb20gJy4vZGInXG5cbmFzeW5jIGZ1bmN0aW9uIG1hdGNoZXModXNlcklkOiBzdHJpbmcpIHtcbiAgICBjb25zdCBkYiA9IGF3YWl0IGdldERCKClcblxuICAgIGNvbnN0IGFsbE1hdGNoZXNJZHMgPSBhd2FpdCBkYi4kcXVlcnlSYXdgU0VMRUNUIEFVLklEXG4gICAgRlJPTSBVU0VSIEFVXG4gICAgSk9JTiAoU0VMRUNUIEIuVVNFUklEIEZST01cbiAgICBMSUtFUyBBXG4gICAgSk9JTlxuICAgIExJS0VTIEJcbiAgICBPTiBBLlVTRVJJRCA9IEIuTElLRURVU0VSSURcbiAgICBXSEVSRSBBLlVTRVJJRCA9ICR7dXNlcklkfVxuICAgIEFORCBCLlVTRVJJRCA9IEEuTElLRURVU0VSSURcbiAgICBBTkQgQS5VU0VSSUQgPSBCLkxJS0VEVVNFUklEKSBNVVxuICAgIE9OIEFVLklEID0gTVUuVVNFUklEO2BcblxuICAgIGNvbnN0IGFsbE1hdGNoZXMgPSBhd2FpdCBkYi51c2VyLmZpbmRNYW55KHtcbiAgICAgICAgd2hlcmU6IHsgXG4gICAgICAgICAgICBpZDoge1xuICAgICAgICAgICAgICAgIGluOiBhbGxNYXRjaGVzSWRzLm1hcCgoaXRlbTogeyBJRDogc3RyaW5nIH0pID0+IGl0ZW0uSUQpXG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9KVxuICAgIHJldHVybiBhbGxNYXRjaGVzXG59XG5cbmV4cG9ydCBkZWZhdWx0IG1hdGNoZXMiXX0=