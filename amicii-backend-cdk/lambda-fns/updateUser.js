"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const db_1 = require("./db");
async function updateUser(user) {
    const db = await db_1.getDB();
    const disconnectPreviouslyConnectedFeatures = db.user.update({
        where: { id: user.id },
        data: {
            features: {
                set: []
            }
        }
    });
    const connectOrCreateNewFeatures = db.user.update({
        where: { id: user.id },
        data: {
            username: user.username,
            age: user.age,
            bio: user.bio,
            genderM: user.genderM,
            genderF: user.genderF,
            profileEmoji: user.profileEmoji,
            features: {
                connectOrCreate: [
                    {
                        where: {
                            emoji: user.features[0].emoji
                        }, create: {
                            emoji: user.features[0].emoji
                        }
                    },
                    {
                        where: {
                            emoji: user.features[1].emoji
                        }, create: {
                            emoji: user.features[1].emoji
                        }
                    },
                    {
                        where: {
                            emoji: user.features[2].emoji
                        }, create: {
                            emoji: user.features[2].emoji
                        }
                    },
                    {
                        where: {
                            emoji: user.features[3].emoji
                        }, create: {
                            emoji: user.features[3].emoji
                        }
                    },
                    {
                        where: {
                            emoji: user.features[4].emoji
                        }, create: {
                            emoji: user.features[4].emoji
                        }
                    },
                    {
                        where: {
                            emoji: user.features[5].emoji
                        }, create: {
                            emoji: user.features[5].emoji
                        }
                    },
                    {
                        where: {
                            emoji: user.features[6].emoji
                        }, create: {
                            emoji: user.features[6].emoji
                        }
                    },
                    {
                        where: {
                            emoji: user.features[7].emoji
                        }, create: {
                            emoji: user.features[7].emoji
                        }
                    },
                    {
                        where: {
                            emoji: user.features[8].emoji
                        }, create: {
                            emoji: user.features[8].emoji
                        }
                    },
                    {
                        where: {
                            emoji: user.features[9].emoji
                        }, create: {
                            emoji: user.features[9].emoji
                        }
                    }
                ]
            }
        }
    });
    try {
        await db.$transaction([disconnectPreviouslyConnectedFeatures, connectOrCreateNewFeatures]);
        return user;
    }
    catch (err) {
        console.log('MySQL error: ', err);
        return null;
    }
}
exports.default = updateUser;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidXBkYXRlVXNlci5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbInVwZGF0ZVVzZXIudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7QUFDQSw2QkFBNEI7QUFFNUIsS0FBSyxVQUFVLFVBQVUsQ0FBQyxJQUFVO0lBQ2hDLE1BQU0sRUFBRSxHQUFHLE1BQU0sVUFBSyxFQUFFLENBQUE7SUFFeEIsTUFBTSxxQ0FBcUMsR0FBSSxFQUFFLENBQUMsSUFBSSxDQUFDLE1BQU0sQ0FBQztRQUMxRCxLQUFLLEVBQUUsRUFBQyxFQUFFLEVBQUUsSUFBSSxDQUFDLEVBQUUsRUFBQztRQUNwQixJQUFJLEVBQUU7WUFDRixRQUFRLEVBQUU7Z0JBQ04sR0FBRyxFQUFFLEVBQUU7YUFDVjtTQUNKO0tBQ0osQ0FBQyxDQUFBO0lBRUYsTUFBTSwwQkFBMEIsR0FBSSxFQUFFLENBQUMsSUFBSSxDQUFDLE1BQU0sQ0FBQztRQUMvQyxLQUFLLEVBQUUsRUFBQyxFQUFFLEVBQUUsSUFBSSxDQUFDLEVBQUUsRUFBQztRQUNwQixJQUFJLEVBQUU7WUFDRixRQUFRLEVBQUUsSUFBSSxDQUFDLFFBQVE7WUFDdkIsR0FBRyxFQUFFLElBQUksQ0FBQyxHQUFHO1lBQ2IsR0FBRyxFQUFFLElBQUksQ0FBQyxHQUFHO1lBQ2IsT0FBTyxFQUFFLElBQUksQ0FBQyxPQUFPO1lBQ3JCLE9BQU8sRUFBRSxJQUFJLENBQUMsT0FBTztZQUNyQixZQUFZLEVBQUUsSUFBSSxDQUFDLFlBQVk7WUFDL0IsUUFBUSxFQUFFO2dCQUNOLGVBQWUsRUFBRTtvQkFDYjt3QkFDSSxLQUFLLEVBQUU7NEJBQ0gsS0FBSyxFQUFFLElBQUksQ0FBQyxRQUFRLENBQUMsQ0FBQyxDQUFDLENBQUMsS0FBSzt5QkFDaEMsRUFBRSxNQUFNLEVBQUU7NEJBQ1AsS0FBSyxFQUFFLElBQUksQ0FBQyxRQUFRLENBQUMsQ0FBQyxDQUFDLENBQUMsS0FBSzt5QkFDaEM7cUJBQ0o7b0JBQ0Q7d0JBQ0ksS0FBSyxFQUFFOzRCQUNI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L3R5cGVzJ1xuaW1wb3J0IHsgZ2V0REIgfSBmcm9tICcuL2RiJ1xuXG5hc3luYyBmdW5jdGlvbiB1cGRhdGVVc2VyKHVzZXI6IFVzZXIpIHtcbiAgICBjb25zdCBkYiA9IGF3YWl0IGdldERCKClcblxuICAgIGNvbnN0IGRpc2Nvbm5lY3RQcmV2aW91c2x5Q29ubmVjdGVkRmVhdHVyZXMgPSAgZGIudXNlci51cGRhdGUoe1xuICAgICAgICB3aGVyZToge2lkOiB1c2VyLmlkfSxcbiAgICAgICAgZGF0YToge1xuICAgICAgICAgICAgZmVhdHVyZXM6IHtcbiAgICAgICAgICAgICAgICBzZXQ6IFtdXG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9KVxuICAgIFxuICAgIGNvbnN0IGNvbm5lY3RPckNyZWF0ZU5ld0ZlYXR1cmVzID0gIGRiLnVzZXIudXBkYXRlKHtcbiAgICAgICAgd2hlcmU6IHtpZDogdXNlci5pZH0sXG4gICAgICAgIGRhdGE6IHtcbiAgICAgICAgICAgIHVzZXJuYW1lOiB1c2VyLnVzZXJuYW1lLFxuICAgICAgICAgICAgYWdlOiB1c2VyLmFnZSxcbiAgICAgICAgICAgIGJpbzogdXNlci5iaW8sXG4gICAgICAgICAgICBnZW5kZXJNOiB1c2VyLmdlbmRlck0sXG4gICAgICAgICAgICBnZW5kZXJGOiB1c2VyLmdlbmRlckYsXG4gICAgICAgICAgICBwcm9maWxlRW1vamk6IHVzZXIucHJvZmlsZUVtb2ppLFxuICAgICAgICAgICAgZmVhdHVyZXM6IHtcbiAgICAgICAgICAgICAgICBjb25uZWN0T3JDcmVhdGU6IFtcbiAgICAgICAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgICAgICAgICAgd2hlcmU6IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbW9qaTogdXNlci5mZWF0dXJlc1swXS5lbW9qaVxuICAgICAgICAgICAgICAgICAgICAgICAgfSwgY3JlYXRlOiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZW1vamk6IHVzZXIuZmVhdHVyZXNbMF0uZW1vamlcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgICAgICAgICAgd2hlcmU6IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbW9qaTogdXNlci5mZWF0dXJlc1sxXS5lbW9qaVxuICAgICAgICAgICAgICAgICAgICAgICAgfSwgY3JlYXRlOiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZW1vamk6IHVzZXIuZmVhdHVyZXNbMV0uZW1vamlcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgICAgICAgICAgd2hlcmU6IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbW9qaTogdXNlci5mZWF0dXJlc1syXS5lbW9qaVxuICAgICAgICAgICAgICAgICAgICAgICAgfSwgY3JlYXRlOiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZW1vamk6IHVzZXIuZmVhdHVyZXNbMl0uZW1vamlcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgICAgICAgICAgd2hlcmU6IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbW9qaTogdXNlci5mZWF0dXJlc1szXS5lbW9qaVxuICAgICAgICAgICAgICAgICAgICAgICAgfSwgY3JlYXRlOiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZW1vamk6IHVzZXIuZmVhdHVyZXNbM10uZW1vamlcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgICAgICAgICAgd2hlcmU6IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbW9qaTogdXNlci5mZWF0dXJlc1s0XS5lbW9qaVxuICAgICAgICAgICAgICAgICAgICAgICAgfSwgY3JlYXRlOiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZW1vamk6IHVzZXIuZmVhdHVyZXNbNF0uZW1vamlcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgICAgICAgICAgd2hlcmU6IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbW9qaTogdXNlci5mZWF0dXJlc1s1XS5lbW9qaVxuICAgICAgICAgICAgICAgICAgICAgICAgfSwgY3JlYXRlOiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZW1vamk6IHVzZXIuZmVhdHVyZXNbNV0uZW1vamlcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgICAgICAgICAgd2hlcmU6IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbW9qaTogdXNlci5mZWF0dXJlc1s2XS5lbW9qaVxuICAgICAgICAgICAgICAgICAgICAgICAgfSwgY3JlYXRlOiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZW1vamk6IHVzZXIuZmVhdHVyZXNbNl0uZW1vamlcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgICAgICAgICAgd2hlcmU6IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbW9qaTogdXNlci5mZWF0dXJlc1s3XS5lbW9qaVxuICAgICAgICAgICAgICAgICAgICAgICAgfSwgY3JlYXRlOiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZW1vamk6IHVzZXIuZmVhdHVyZXNbN10uZW1vamlcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgICAgICAgICAgd2hlcmU6IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbW9qaTogdXNlci5mZWF0dXJlc1s4XS5lbW9qaVxuICAgICAgICAgICAgICAgICAgICAgICAgfSwgY3JlYXRlOiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZW1vamk6IHVzZXIuZmVhdHVyZXNbOF0uZW1vamlcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgICAgICAgICAgd2hlcmU6IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbW9qaTogdXNlci5mZWF0dXJlc1s5XS5lbW9qaVxuICAgICAgICAgICAgICAgICAgICAgICAgfSwgY3JlYXRlOiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZW1vamk6IHVzZXIuZmVhdHVyZXNbOV0uZW1vamlcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIF1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH0pXG5cbiAgICB0cnkge1xuICAgICAgICBhd2FpdCBkYi4kdHJhbnNhY3Rpb24oW2Rpc2Nvbm5lY3RQcmV2aW91c2x5Q29ubmVjdGVkRmVhdHVyZXMsIGNvbm5lY3RPckNyZWF0ZU5ld0ZlYXR1cmVzIF0pXG4gICAgICAgIHJldHVybiB1c2VyXG4gICAgfSBjYXRjaCAoZXJyKSB7XG4gICAgICAgIGNvbnNvbGUubG9nKCdNeVNRTCBlcnJvcjogJywgZXJyKVxuICAgICAgICByZXR1cm4gbnVsbFxuICAgIH1cbn1cblxuZXhwb3J0IGRlZmF1bHQgdXBkYXRlVXNlciJdfQ==