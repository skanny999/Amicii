"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const db_1 = require("./db");
async function updateUser(user) {
    const db = await db_1.getDB();
    const disconnectPreviouslyConnectedFeatures = db.user.update({
        where: { id: user.id },
        data: {
            features: {
                set: []
            }
        }
    });
    const connectOrCreateNewFeatures = db.user.update({
        where: { id: user.id },
        data: {
            username: user.username,
            age: user.age,
            bio: user.bio,
            genderM: user.genderM,
            genderF: user.genderF,
            profileEmoji: user.profileEmoji,
            createdOn: user.createdOn,
            features: {
                connectOrCreate: [
                    {
                        where: {
                            emoji: user.features[0].emoji
                        }, create: {
                            emoji: user.features[0].emoji
                        }
                    },
                    {
                        where: {
                            emoji: user.features[1].emoji
                        }, create: {
                            emoji: user.features[1].emoji
                        }
                    },
                    {
                        where: {
                            emoji: user.features[2].emoji
                        }, create: {
                            emoji: user.features[2].emoji
                        }
                    },
                    {
                        where: {
                            emoji: user.features[3].emoji
                        }, create: {
                            emoji: user.features[3].emoji
                        }
                    },
                    {
                        where: {
                            emoji: user.features[4].emoji
                        }, create: {
                            emoji: user.features[4].emoji
                        }
                    },
                    {
                        where: {
                            emoji: user.features[5].emoji
                        }, create: {
                            emoji: user.features[5].emoji
                        }
                    },
                    {
                        where: {
                            emoji: user.features[6].emoji
                        }, create: {
                            emoji: user.features[6].emoji
                        }
                    },
                    {
                        where: {
                            emoji: user.features[7].emoji
                        }, create: {
                            emoji: user.features[7].emoji
                        }
                    },
                    {
                        where: {
                            emoji: user.features[8].emoji
                        }, create: {
                            emoji: user.features[8].emoji
                        }
                    },
                    {
                        where: {
                            emoji: user.features[9].emoji
                        }, create: {
                            emoji: user.features[9].emoji
                        }
                    }
                ]
            }
        }
    });
    try {
        await db.$transaction([disconnectPreviouslyConnectedFeatures, connectOrCreateNewFeatures]);
        return user;
    }
    catch (err) {
        console.log('MySQL error: ', err);
        return null;
    }
}
exports.default = updateUser;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidXBkYXRlVXNlci5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbInVwZGF0ZVVzZXIudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7QUFDQSw2QkFBNEI7QUFFNUIsS0FBSyxVQUFVLFVBQVUsQ0FBQyxJQUFVO0lBQ2hDLE1BQU0sRUFBRSxHQUFHLE1BQU0sVUFBSyxFQUFFLENBQUE7SUFFeEIsTUFBTSxxQ0FBcUMsR0FBSSxFQUFFLENBQUMsSUFBSSxDQUFDLE1BQU0sQ0FBQztRQUMxRCxLQUFLLEVBQUUsRUFBQyxFQUFFLEVBQUUsSUFBSSxDQUFDLEVBQUUsRUFBQztRQUNwQixJQUFJLEVBQUU7WUFDRixRQUFRLEVBQUU7Z0JBQ04sR0FBRyxFQUFFLEVBQUU7YUFDVjtTQUNKO0tBQ0osQ0FBQyxDQUFBO0lBRUYsTUFBTSwwQkFBMEIsR0FBSSxFQUFFLENBQUMsSUFBSSxDQUFDLE1BQU0sQ0FBQztRQUMvQyxLQUFLLEVBQUUsRUFBQyxFQUFFLEVBQUUsSUFBSSxDQUFDLEVBQUUsRUFBQztRQUNwQixJQUFJLEVBQUU7WUFDRixRQUFRLEVBQUUsSUFBSSxDQUFDLFFBQVE7WUFDdkIsR0FBRyxFQUFFLElBQUksQ0FBQyxHQUFHO1lBQ2IsR0FBRyxFQUFFLElBQUksQ0FBQyxHQUFHO1lBQ2IsT0FBTyxFQUFFLElBQUksQ0FBQyxPQUFPO1lBQ3JCLE9BQU8sRUFBRSxJQUFJLENBQUMsT0FBTztZQUNyQixZQUFZLEVBQUUsSUFBSSxDQUFDLFlBQVk7WUFDL0IsU0FBUyxFQUFFLElBQUksQ0FBQyxTQUFTO1lBQ3pCLFFBQVEsRUFBRTtnQkFDTixlQUFlLEVBQUU7b0JBQ2I7d0JBQ0ksS0FBSyxFQUFFOzRCQUNILEtBQUssRUFBRSxJQUFJLENBQUMsUUFBUSxDQUFDLENBQUMsQ0FBQyxDQUFDLEtBQUs7eUJBQ2hDLEVBQUUsTUFBTSxFQUFFOzRCQUNQLEtBQUssRUFBRSxJQUFJLENBQUMsUUFBUSxDQUFDLENBQUMsQ0FBQyxDQUFDLEtBQUs7eUJBQ2hDO3FC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dGVudCI6WyJpbXBvcnQgeyBVc2VyIH0gZnJvbSAnLi90eXBlcydcbmltcG9ydCB7IGdldERCIH0gZnJvbSAnLi9kYidcblxuYXN5bmMgZnVuY3Rpb24gdXBkYXRlVXNlcih1c2VyOiBVc2VyKSB7XG4gICAgY29uc3QgZGIgPSBhd2FpdCBnZXREQigpXG5cbiAgICBjb25zdCBkaXNjb25uZWN0UHJldmlvdXNseUNvbm5lY3RlZEZlYXR1cmVzID0gIGRiLnVzZXIudXBkYXRlKHtcbiAgICAgICAgd2hlcmU6IHtpZDogdXNlci5pZH0sXG4gICAgICAgIGRhdGE6IHtcbiAgICAgICAgICAgIGZlYXR1cmVzOiB7XG4gICAgICAgICAgICAgICAgc2V0OiBbXVxuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfSlcbiAgICBcbiAgICBjb25zdCBjb25uZWN0T3JDcmVhdGVOZXdGZWF0dXJlcyA9ICBkYi51c2VyLnVwZGF0ZSh7XG4gICAgICAgIHdoZXJlOiB7aWQ6IHVzZXIuaWR9LFxuICAgICAgICBkYXRhOiB7XG4gICAgICAgICAgICB1c2VybmFtZTogdXNlci51c2VybmFtZSxcbiAgICAgICAgICAgIGFnZTogdXNlci5hZ2UsXG4gICAgICAgICAgICBiaW86IHVzZXIuYmlvLFxuICAgICAgICAgICAgZ2VuZGVyTTogdXNlci5nZW5kZXJNLFxuICAgICAgICAgICAgZ2VuZGVyRjogdXNlci5nZW5kZXJGLFxuICAgICAgICAgICAgcHJvZmlsZUVtb2ppOiB1c2VyLnByb2ZpbGVFbW9qaSxcbiAgICAgICAgICAgIGNyZWF0ZWRPbjogdXNlci5jcmVhdGVkT24sXG4gICAgICAgICAgICBmZWF0dXJlczoge1xuICAgICAgICAgICAgICAgIGNvbm5lY3RPckNyZWF0ZTogW1xuICAgICAgICAgICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgICAgICAgICB3aGVyZToge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVtb2ppOiB1c2VyLmZlYXR1cmVzWzBdLmVtb2ppXG4gICAgICAgICAgICAgICAgICAgICAgICB9LCBjcmVhdGU6IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbW9qaTogdXNlci5mZWF0dXJlc1swXS5lbW9qaVxuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgICAgICAgICB3aGVyZToge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVtb2ppOiB1c2VyLmZlYXR1cmVzWzFdLmVtb2ppXG4gICAgICAgICAgICAgICAgICAgICAgICB9LCBjcmVhdGU6IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbW9qaTogdXNlci5mZWF0dXJlc1sxXS5lbW9qaVxuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgICAgICAgICB3aGVyZToge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVtb2ppOiB1c2VyLmZlYXR1cmVzWzJdLmVtb2ppXG4gICAgICAgICAgICAgICAgICAgICAgICB9LCBjcmVhdGU6IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbW9qaTogdXNlci5mZWF0dXJlc1syXS5lbW9qaVxuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgICAgICAgICB3aGVyZToge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVtb2ppOiB1c2VyLmZlYXR1cmVzWzNdLmVtb2ppXG4gICAgICAgICAgICAgICAgICAgICAgICB9LCBjcmVhdGU6IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbW9qaTogdXNlci5mZWF0dXJlc1szXS5lbW9qaVxuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgICAgICAgICB3aGVyZToge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVtb2ppOiB1c2VyLmZlYXR1cmVzWzRdLmVtb2ppXG4gICAgICAgICAgICAgICAgICAgICAgICB9LCBjcmVhdGU6IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbW9qaTogdXNlci5mZWF0dXJlc1s0XS5lbW9qaVxuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgICAgICAgICB3aGVyZToge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVtb2ppOiB1c2VyLmZlYXR1cmVzWzVdLmVtb2ppXG4gICAgICAgICAgICAgICAgICAgICAgICB9LCBjcmVhdGU6IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbW9qaTogdXNlci5mZWF0dXJlc1s1XS5lbW9qaVxuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgICAgICAgICB3aGVyZToge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVtb2ppOiB1c2VyLmZlYXR1cmVzWzZdLmVtb2ppXG4gICAgICAgICAgICAgICAgICAgICAgICB9LCBjcmVhdGU6IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbW9qaTogdXNlci5mZWF0dXJlc1s2XS5lbW9qaVxuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgICAgICAgICB3aGVyZToge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVtb2ppOiB1c2VyLmZlYXR1cmVzWzddLmVtb2ppXG4gICAgICAgICAgICAgICAgICAgICAgICB9LCBjcmVhdGU6IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbW9qaTogdXNlci5mZWF0dXJlc1s3XS5lbW9qaVxuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgICAgICAgICB3aGVyZToge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVtb2ppOiB1c2VyLmZlYXR1cmVzWzhdLmVtb2ppXG4gICAgICAgICAgICAgICAgICAgICAgICB9LCBjcmVhdGU6IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbW9qaTogdXNlci5mZWF0dXJlc1s4XS5lbW9qaVxuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgICAgICAgICB3aGVyZToge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVtb2ppOiB1c2VyLmZlYXR1cmVzWzldLmVtb2ppXG4gICAgICAgICAgICAgICAgICAgICAgICB9LCBjcmVhdGU6IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbW9qaTogdXNlci5mZWF0dXJlc1s5XS5lbW9qaVxuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgXVxuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfSlcblxuICAgIHRyeSB7XG4gICAgICAgIGF3YWl0IGRiLiR0cmFuc2FjdGlvbihbZGlzY29ubmVjdFByZXZpb3VzbHlDb25uZWN0ZWRGZWF0dXJlcywgY29ubmVjdE9yQ3JlYXRlTmV3RmVhdHVyZXMgXSlcbiAgICAgICAgcmV0dXJuIHVzZXJcbiAgICB9IGNhdGNoIChlcnIpIHtcbiAgICAgICAgY29uc29sZS5sb2coJ015U1FMIGVycm9yOiAnLCBlcnIpXG4gICAgICAgIHJldHVybiBudWxsXG4gICAgfVxufVxuXG5leHBvcnQgZGVmYXVsdCB1cGRhdGVVc2VyIl19