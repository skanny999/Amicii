"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const db_1 = require("./db");
async function updateUser(user) {
    const db = await db_1.getDB();
    const disconnectPreviouslyConnectedFeatures = db.user.update({
        where: { id: user.id },
        data: {
            features: {
                set: []
            }
        }
    });
    const connectOrCreateNewFeatures = db.user.update({
        where: { id: user.id },
        data: {
            username: user.username,
            age: user.age,
            bio: user.bio,
            genderM: user.genderM,
            genderF: user.genderF,
            profileEmoji: user.profileEmoji,
            features: {
                connectOrCreate: [
                    {
                        where: {
                            emoji: user.features[0].emoji
                        }, create: {
                            emoji: user.features[0].emoji
                        }
                    },
                    {
                        where: {
                            emoji: user.features[1].emoji
                        }, create: {
                            emoji: user.features[1].emoji
                        }
                    },
                    {
                        where: {
                            emoji: user.features[2].emoji
                        }, create: {
                            emoji: user.features[2].emoji
                        }
                    },
                    {
                        where: {
                            emoji: user.features[3].emoji
                        }, create: {
                            emoji: user.features[3].emoji
                        }
                    },
                    {
                        where: {
                            emoji: user.features[4].emoji
                        }, create: {
                            emoji: user.features[4].emoji
                        }
                    },
                    {
                        where: {
                            emoji: user.features[5].emoji
                        }, create: {
                            emoji: user.features[5].emoji
                        }
                    },
                    {
                        where: {
                            emoji: user.features[6].emoji
                        }, create: {
                            emoji: user.features[6].emoji
                        }
                    },
                    {
                        where: {
                            emoji: user.features[7].emoji
                        }, create: {
                            emoji: user.features[7].emoji
                        }
                    },
                    {
                        where: {
                            emoji: user.features[8].emoji
                        }, create: {
                            emoji: user.features[8].emoji
                        }
                    },
                    {
                        where: {
                            emoji: user.features[9].emoji
                        }, create: {
                            emoji: user.features[9].emoji
                        }
                    }
                ]
            }
        }
    });
    try {
        await db.$transaction([disconnectPreviouslyConnectedFeatures, connectOrCreateNewFeatures]);
        return user;
    }
    catch (err) {
        console.log('MySQL error: ', err);
        return null;
    }
}
exports.default = updateUser;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidXBkYXRlVXNlci5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbInVwZGF0ZVVzZXIudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7QUFDQSw2QkFBNEI7QUFFNUIsS0FBSyxVQUFVLFVBQVUsQ0FBQyxJQUFVO0lBRWhDLE1BQU0sRUFBRSxHQUFHLE1BQU0sVUFBSyxFQUFFLENBQUE7SUFJeEIsTUFBTSxxQ0FBcUMsR0FBSSxFQUFFLENBQUMsSUFBSSxDQUFDLE1BQU0sQ0FBQztRQUMxRCxLQUFLLEVBQUUsRUFBQyxFQUFFLEVBQUUsSUFBSSxDQUFDLEVBQUUsRUFBQztRQUNwQixJQUFJLEVBQUU7WUFDRixRQUFRLEVBQUU7Z0JBQ04sR0FBRyxFQUFFLEVBQUU7YUFDVjtTQUNKO0tBQ0osQ0FBQyxDQUFBO0lBRUYsTUFBTSwwQkFBMEIsR0FBSSxFQUFFLENBQUMsSUFBSSxDQUFDLE1BQU0sQ0FBQztRQUMvQyxLQUFLLEVBQUUsRUFBQyxFQUFFLEVBQUUsSUFBSSxDQUFDLEVBQUUsRUFBQztRQUNwQixJQUFJLEVBQUU7WUFDRixRQUFRLEVBQUUsSUFBSSxDQUFDLFFBQVE7WUFDdkIsR0FBRyxFQUFFLElBQUksQ0FBQyxHQUFHO1lBQ2IsR0FBRyxFQUFFLElBQUksQ0FBQyxHQUFHO1lBQ2IsT0FBTyxFQUFFLElBQUksQ0FBQyxPQUFPO1lBQ3JCLE9BQU8sRUFBRSxJQUFJLENBQUMsT0FBTztZQUNyQixZQUFZLEVBQUUsSUFBSSxDQUFDLFlBQVk7WUFDL0IsUUFBUSxFQUFFO2dCQUNOLGVBQWUsRUFBRTtvQkFDYjt3QkFDSSxLQUFLLEVBQUU7NEJBQ0gsS0FBSyxFQUFFLElBQUksQ0FBQyxRQUFRLENBQUMsQ0FBQyxDQUFDLENBQUMsS0FBSzt5QkFDaEMsRUFBRSxNQUFNLEVBQUU7NEJBQ1AsS0FBSyxFQUFFLElBQUksQ0FBQyxRQUFRLENBQUMsQ0FBQyxDQUFDLENBQUMsS0FBSzt5QkFDaEM7cUJBQ0o7b0JBQ0Q7d0JBQ0ksS0FBSyxFQUFFOzRCQUNI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L3R5cGVzJ1xuaW1wb3J0IHsgZ2V0REIgfSBmcm9tICcuL2RiJ1xuXG5hc3luYyBmdW5jdGlvbiB1cGRhdGVVc2VyKHVzZXI6IFVzZXIpIHtcblxuICAgIGNvbnN0IGRiID0gYXdhaXQgZ2V0REIoKVxuXG5cbiAgICBcbiAgICBjb25zdCBkaXNjb25uZWN0UHJldmlvdXNseUNvbm5lY3RlZEZlYXR1cmVzID0gIGRiLnVzZXIudXBkYXRlKHtcbiAgICAgICAgd2hlcmU6IHtpZDogdXNlci5pZH0sXG4gICAgICAgIGRhdGE6IHtcbiAgICAgICAgICAgIGZlYXR1cmVzOiB7XG4gICAgICAgICAgICAgICAgc2V0OiBbXVxuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfSlcbiAgICBcbiAgICBjb25zdCBjb25uZWN0T3JDcmVhdGVOZXdGZWF0dXJlcyA9ICBkYi51c2VyLnVwZGF0ZSh7XG4gICAgICAgIHdoZXJlOiB7aWQ6IHVzZXIuaWR9LFxuICAgICAgICBkYXRhOiB7XG4gICAgICAgICAgICB1c2VybmFtZTogdXNlci51c2VybmFtZSxcbiAgICAgICAgICAgIGFnZTogdXNlci5hZ2UsXG4gICAgICAgICAgICBiaW86IHVzZXIuYmlvLFxuICAgICAgICAgICAgZ2VuZGVyTTogdXNlci5nZW5kZXJNLFxuICAgICAgICAgICAgZ2VuZGVyRjogdXNlci5nZW5kZXJGLFxuICAgICAgICAgICAgcHJvZmlsZUVtb2ppOiB1c2VyLnByb2ZpbGVFbW9qaSxcbiAgICAgICAgICAgIGZlYXR1cmVzOiB7XG4gICAgICAgICAgICAgICAgY29ubmVjdE9yQ3JlYXRlOiBbXG4gICAgICAgICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHdoZXJlOiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZW1vamk6IHVzZXIuZmVhdHVyZXNbMF0uZW1vamlcbiAgICAgICAgICAgICAgICAgICAgICAgIH0sIGNyZWF0ZToge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVtb2ppOiB1c2VyLmZlYXR1cmVzWzBdLmVtb2ppXG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHdoZXJlOiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZW1vamk6IHVzZXIuZmVhdHVyZXNbMV0uZW1vamlcbiAgICAgICAgICAgICAgICAgICAgICAgIH0sIGNyZWF0ZToge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVtb2ppOiB1c2VyLmZlYXR1cmVzWzFdLmVtb2ppXG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHdoZXJlOiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZW1vamk6IHVzZXIuZmVhdHVyZXNbMl0uZW1vamlcbiAgICAgICAgICAgICAgICAgICAgICAgIH0sIGNyZWF0ZToge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVtb2ppOiB1c2VyLmZlYXR1cmVzWzJdLmVtb2ppXG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHdoZXJlOiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZW1vamk6IHVzZXIuZmVhdHVyZXNbM10uZW1vamlcbiAgICAgICAgICAgICAgICAgICAgICAgIH0sIGNyZWF0ZToge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVtb2ppOiB1c2VyLmZlYXR1cmVzWzNdLmVtb2ppXG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHdoZXJlOiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZW1vamk6IHVzZXIuZmVhdHVyZXNbNF0uZW1vamlcbiAgICAgICAgICAgICAgICAgICAgICAgIH0sIGNyZWF0ZToge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVtb2ppOiB1c2VyLmZlYXR1cmVzWzRdLmVtb2ppXG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHdoZXJlOiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZW1vamk6IHVzZXIuZmVhdHVyZXNbNV0uZW1vamlcbiAgICAgICAgICAgICAgICAgICAgICAgIH0sIGNyZWF0ZToge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVtb2ppOiB1c2VyLmZlYXR1cmVzWzVdLmVtb2ppXG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHdoZXJlOiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZW1vamk6IHVzZXIuZmVhdHVyZXNbNl0uZW1vamlcbiAgICAgICAgICAgICAgICAgICAgICAgIH0sIGNyZWF0ZToge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVtb2ppOiB1c2VyLmZlYXR1cmVzWzZdLmVtb2ppXG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHdoZXJlOiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZW1vamk6IHVzZXIuZmVhdHVyZXNbN10uZW1vamlcbiAgICAgICAgICAgICAgICAgICAgICAgIH0sIGNyZWF0ZToge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVtb2ppOiB1c2VyLmZlYXR1cmVzWzddLmVtb2ppXG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHdoZXJlOiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZW1vamk6IHVzZXIuZmVhdHVyZXNbOF0uZW1vamlcbiAgICAgICAgICAgICAgICAgICAgICAgIH0sIGNyZWF0ZToge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVtb2ppOiB1c2VyLmZlYXR1cmVzWzhdLmVtb2ppXG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHdoZXJlOiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZW1vamk6IHVzZXIuZmVhdHVyZXNbOV0uZW1vamlcbiAgICAgICAgICAgICAgICAgICAgICAgIH0sIGNyZWF0ZToge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVtb2ppOiB1c2VyLmZlYXR1cmVzWzldLmVtb2ppXG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBdXG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9KVxuXG4gICAgdHJ5IHtcbiAgICAgICAgYXdhaXQgZGIuJHRyYW5zYWN0aW9uKFtkaXNjb25uZWN0UHJldmlvdXNseUNvbm5lY3RlZEZlYXR1cmVzLCBjb25uZWN0T3JDcmVhdGVOZXdGZWF0dXJlcyBdKVxuICAgICAgICByZXR1cm4gdXNlclxuICAgIH0gY2F0Y2ggKGVycikge1xuICAgICAgICBjb25zb2xlLmxvZygnTXlTUUwgZXJyb3I6ICcsIGVycilcbiAgICAgICAgcmV0dXJuIG51bGxcbiAgICB9XG59XG5cbmV4cG9ydCBkZWZhdWx0IHVwZGF0ZVVzZXIiXX0=